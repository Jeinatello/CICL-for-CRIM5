<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CICL Simulation – RA 9344 & 10630</title>
<style>
    html, body { margin:0; padding:0; height:100%; width:100%; overflow:hidden; font-family: "Segoe UI", Arial, sans-serif; background:#000; }
    #game-container { width:100%; height:100%; position:relative; background-size:cover; background-position:center; overflow:hidden; }
    #title-screen { position:absolute; inset:0; background: rgba(0,0,0,0.85); display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; z-index:20; transition:opacity 0.8s; }
    #title-screen.hidden { opacity:0; pointer-events:none; }
    #title-title { font-size:36px; font-weight:bold; color:#fff; margin-bottom:20px; text-shadow:0 0 10px #000; }
    #title-sub { font-size:20px; opacity:0.85; margin-bottom:40px; color:#fff; }
    #start-button { background:#66c2ff; color:#000; padding:12px 30px; font-size:20px; border-radius:8px; cursor:pointer; font-weight:bold; box-shadow:0 0 12px #66c2ff; transition:0.3s; }
    #start-button:hover { background:#a7e0ff; transform:translateY(-3px); box-shadow:0 0 20px #a7e0ff; }
    #characters-container { position:absolute; bottom:0; width:100%; height:75%; }
    .character-img { position:absolute; bottom:0; height:75%; opacity:0; transition:opacity 0.8s, transform 0.8s; transform:translateY(20px); }
    .character-img.show { opacity:1; transform:translateY(0px); }
    #dialogue-box { position:absolute; bottom:0; width:100%; background: rgba(0,0,0,0.65); padding:22px; box-sizing:border-box; border-top:2px solid rgba(255,255,255,0.2); backdrop-filter:blur(5px); opacity:0; transform:translateY(20px); transition:opacity .6s, transform .6s; color:#fff; }
    #dialogue-box.visible { opacity:1; transform:translateY(0px); }
    #name { font-size:22px; font-weight:bold; margin-bottom:8px; color:#66c2ff; text-shadow:0 0 6px #000; }
    #text { font-size:18px; margin-bottom:14px; line-height:1.45; }
    .choice { background: rgba(255,255,255,0.12); padding:10px; margin:6px 0; border-radius:6px; cursor:pointer; transition:0.3s; border-left:4px solid #66c2ff; }
    .choice:hover { background: rgba(255,255,255,0.28); transform:translateX(4px); }
    .extra-btn { background: rgba(255,255,255,0.15); color:#fff; padding:7px 12px; border-radius:4px; cursor:pointer; margin-right:6px; display:inline-block; font-size:14px; transition:0.3s; border:1px solid rgba(255,255,255,0.15); }
    .extra-btn:hover { background: rgba(255,255,255,0.30); }

    /* Comic Slideshow */
    #comic-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: calc(100vh - 150px); /* leave space for dialogue box */
    display: flex;
    justify-content: center;
    align-items: center;
    background: #000;
    z-index: 30;
}

    .comic-slide {
    width: auto;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

    .comic-slide.show { opacity:1; }

    /* Diagram Map */
    #diagram-map { position:absolute; top:50px; left:50px; width:80%; height:80%; background:rgba(0,0,0,0.9); z-index:50; display:none; overflow:auto; border:2px solid #66c2ff; border-radius:10px; }
    .diagram-node { position:absolute; padding:6px 10px; background:#66c2ff; color:#000; border-radius:6px; cursor:pointer; text-align:center; font-size:14px; font-weight:bold; }
</style>
</head>
<body>

<div id="diagram-map-overlay" style="
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.85);
    display:none;
    z-index:50;
    overflow:auto;
    padding:20px;
">
    <div style="text-align:right;">
        <button id="close-map-btn" style="
            background:#ff5555;
            color:#fff;
            border:none;
            padding:6px 12px;
            cursor:pointer;
            font-weight:bold;
            border-radius:4px;
        ">Close</button>
    </div>
    <div id="diagram-map-container"></div>
</div>

<div id="game-container">
    <div id="title-screen">
        <div id="title-title">Process of Handling a CICL</div>
        <div id="title-sub">A Guided Simulation of RA 9344 & 10630 Procedures</div>
        <div id="start-button" onclick="startGame()">START</div>
    </div>

    <div id="characters-container"></div>

    <div id="dialogue-box">
        <div id="name"></div>
        <div id="text"></div>
        <div id="choices"></div>
        <div id="extra-buttons"></div>
    </div>

    <div id="comic-container">
        <div id="comic1" class="comic-slide" style="background-image:url('comic1.png')"></div>
        <div id="comic2" class="comic-slide" style="background-image:url('comic2.png')"></div>
        <div id="comic3" class="comic-slide" style="background-image:url('comic3.png')"></div>
    </div>

    <div id="diagram-map"></div>
</div>

<script>
let previousScene = null;

/* SCENES */
let scenes = {
    startScene: { name:"Lazo", text:"A Child has reportedly committed an offense. You will now simulate the CICL procedures under RA 9344 & 10630.", bg:"bg_community.png", char:["narrator.png"], choices:[{text:"Begin Simulation", next:"leoContact"}]},
    leoContact: { name:"LEO", text:"I approached the child calmly. I must avoid intimidation and introduce myself as Ate/Kuya.", bg:"bg_street_leo.png", char:["leo.png"], choices:[{text:"Perform LEO Duties", next:"leoDuties"}]},
    leoDuties: { name:"LEO", text:"Determine the child's age using one of the following:", bg:"bg_police_station.png", char:["leo.png"], choices:[
        {text:"Birth Certificate", next:"informParties"}, 
        {text:"Baptismal", next:"informParties"},
        {text:"School Records", next:"informParties"},
        {text:"No Records", next:"noRecords"}
    ]},
    informParties: { name:"LEO", text:"Inform the following parties:", bg:"bg_police_station.png", char:["leo.png"], choices:[
        {text:"Inform Parents, Social Worker, PAO", next:"allInformed"}
    ]},
    allInformed: { name:"LEO", text:"All Parties are Informed.", bg:"bg_police_station.png", char:["leo.png"], choices:[
        {text:"Proceed to Nearest Public Hospital and Conduct Medico-Legal", next:"wcpd"}
    ]},
    noRecords: { name:"LEO", text:"No records found. Use discretion to verify age.", bg:"bg_police_station.png", char:["leo.png"], choices:[
        {text:"Proceed to Inform the Following", next:"informParties"}
    ]},
    wcpd: { name:"Social Worker", text:"I will be assisting with the case. We will categorize the child based on age and discernment.", bg:"bg_wcpd.png", char:["socialworker.png"], choices:[{text:"Determine Age", next:"ageSelect"}]},
    ageSelect: { name:"Social Worker", text:"Select the child's age category:", bg:"bg_dswd.png", char:["socialworker.png"], choices:[
        {text:"15 and below", next:"age15below"},
        {text:"15 to below 18", next:"age15to18"}
    ]},
    age15below: { name:"Social Worker", text:"The child is 15 or below. Under RA 9344, the child is totally exempt from criminal liability.", bg:"bg_dswd.png", char:["socialworker.png"], choices:[
        {text:"Turn over to the parents/guardian", next:"turnoverParents15below"},
        {text:"Return", next:"ageSelect"}
    ]},
    turnoverParents15below: { name:"Parents", text:"The parents will take responsibility for the child.", bg:"bg_house.png", char:["mother.png","father.png"], choices:[
        {text:"Refer to Intervention Program", next:"interventionEnd"},
        {text:"Back", next:"age15below"}
    ]},
    interventionEnd: { name:"Narrator", text:"The child is placed in an intervention program and will be reintegrated into the community.", bg:"bg_community.png", char:[]},
    age15to18: { name:"Social Worker", text:"The child is 15 above but below 18. Now determine DISCERNMENT:", bg:"bg_wcpd.png", char:["socialworker.png"], choices:[
        {text:"Without discernment", next:"noDiscernment"},
        {text:"With discernment", next:"withDiscernment"},
        {text:"Return", next:"ageSelect"}
    ]},
    noDiscernment: { name:"Social Worker", text:"The child acted WITHOUT discernment. Legal outcome: Intervention Program.", bg:"bg_dswd.png", char:["socialworker.png"], choices:[
        {text:"Turn over to parents", next:"interventionEnd"},
        {text:"Back", next:"age15to18"}
    ]},
    withDiscernment: { name:"Social Worker", text:"The child acted WITH discernment. Determine the nature of the offense:", bg:"bg_dswd.png", char:["socialworker.png"], choices:[
        {text:"Non-serious offense", next:"nonSerious"},
        {text:"Serious offense", next:"seriousSelectAge"},
        {text:"Back", next:"age15to18"}
    ]},
    nonSerious: { name:"Social Worker", text:"Non-serious offense. The child qualifies for DIVERSION unless disqualified.", bg:"bg_dswd.png", char:["socialworker.png"], choices:[
        {text:"Proceed with Diversion", next:"diversionEnd"},
        {text:"Child is disqualified → Proceed to Court", next:"prosecutionStart"},
        {text:"Back", next:"withDiscernment"}
    ]},
    diversionEnd: { name:"Lazo", text:"A diversion conference is conducted and the child complies.", bg:"bg_community.png", char:["narrator.png"]},
    seriousSelectAge: { name:"Social Worker", text:"Determine the child’s age for serious crime procedures:", bg:"bg_dswd.png", char:["socialworker.png"], choices:[
        {text:"Age 12 to 15, serious crime", next:"serious12to15"},
        {text:"Age 15 to 18, serious crime", next:"serious15to18"},
        {text:"Back", next:"withDiscernment"}
    ]},
    serious12to15: { name:"Social Worker", text:"For ages 12 to 15 with a serious offense: Bahay Pag-asa → IJISC/IIP → If repetition: offenses under SPL/RPC: Bahay Pag-asa → IJISC/IIP.", bg:"bg_dswd.png", char:["socialworker.png"], choices:[
        {text:"Proceed to Bahay Pag-asa", next:"bpaEnd"},
        {text:"Back", next:"seriousSelectAge"}
    ]},
    bpaEnd: { name:"Lazo", text:"The child undergoes IJISC/IIP and is later reintegrated.", bg:"bg_dswd.png", char:[]},
    serious15to18: { name:"Social Worker", text:"For ages 15 to 18 with serious offense and penalty >6 yrs and above: Proceed to Prosecution.", bg:"bg_dswd.png", char:["socialworker.png"], choices:[
        {text:"Proceed to Prosecution", next:"prosecutionStart"},
        {text:"Back", next:"seriousSelectAge"}
    ]},
    prosecutionStart: { name:"Prosecutor", text:"Preliminary Investigation begins.", bg:"bg_prosecutor.png", char:["prosecutor.png"], choices:[
        {text:"Determine Probable Cause", next:"probableCause"},
        {text:"Back", next:"serious15to18"}
    ]},
    probableCause: { name:"Prosecutor", text:"Probable Cause is established. Filing Information to the Court.", bg:"bg_prosecutor.png", char:["prosecutor.png"], choices:[
        {text:"Proceed to Court", next:"court"},
        {text:"Back", next:"prosecutionStart"}
    ]},
    court: { name:"Judge", text:"The Family Court hears the case with child-sensitive procedures.", bg:"bg_court.png", char:["judge.png"], choices:[
        {text:"Child is NOT GUILTY", next:"notGuilty"},
        {text:"Child is GUILTY", next:"guilty"},
        {text:"Back", next:"probableCause"}
    ]},
    notGuilty: { name:"Lazo", text:"Case dismissed. The child returns to his/her family and society.", bg:"bg_community.png", char:["cicl.png"]},
    guilty: { name:"Judge", text:"Child is found GUILTY. Sentence is suspended. Commitment to Youth Rehabilitation Center.", bg:"bg_court.png", char:["judge.png"], choices:[
        {text:"Assess Degree of Change", next:"degreeCheck"},
        {text:"Back", next:"court"}
    ]},
    degreeCheck: { name:"Social Worker", text:"Evaluate if the child demonstrates degree of change (disposition).", bg:"bg_house.png", char:["socialworker.png"], choices:[
        {text:"Degree achieved", next:"fulfilled"},
        {text:"Not achieved", next:"notFulfilled"},
        {text:"Back", next:"guilty"}
    ]},
    fulfilled: { name:"Judge", text:"Degree of change achieved (Fulfilled). Case dismissed. Child reintegrated with no criminal records.", bg:"bg_court.png", char:["judge.png"]},
    notFulfilled: { name:"Judge", text:"Degree of change not achieved (Not Fulfilled). Criminal records generated. Options:", bg:"bg_court.png", char:["judge.png"], choices:[
        {text:"Probation", next:"probationEnd"},
        {text:"Agricultural Penal Farm", next:"continueYRC"},
        {text:"Back", next:"degreeCheck"}
    ]},
    probationEnd: { name:"Lazo", text:"Child is placed on probation with monitoring and continuing observation.", bg:"bg_community.png", char:["cicl.png"]},
    continueYRC: { name:"Lazo", text:"Child is placed in Agricultural Penal Farm until sentence completion.", bg:"bg_house.png", char:["cicl.png"], choices:[
        {text:"End Simulation", next:"simulationEnd"}
    ]},
    simulationEnd: { name:"Lazo", text:"You have reached the end of the Simulation. Thank you for participating.", bg:"bg_community.png", char:["narrator.png"]}
};

/* START GAME */
function startGame(){
    document.getElementById("title-screen").classList.add("hidden");
    startComic();
}

/* COMIC SLIDESHOW */
let comicIndex = 0;
function startComic(){
    const comics = ["comic1","comic2","comic3"];
    const container = document.getElementById("comic-container");
    container.style.display="flex";
    showComicSlide(comicIndex);

    let nextBtn = document.createElement("div");
    nextBtn.className="extra-btn";
    nextBtn.innerText="Next";
    nextBtn.style.position="absolute";
    nextBtn.style.bottom="30px";
    nextBtn.style.right="30px";
    container.appendChild(nextBtn);

    nextBtn.onclick = () => {
        comicIndex++;
        if(comicIndex >= comics.length){
            container.style.display="none";
            show("startScene"); // first dialogue scene
        } else {
            showComicSlide(comicIndex);
        }
    };
}

function showComicSlide(idx){
    document.querySelectorAll(".comic-slide").forEach(el=>el.classList.remove("show"));
    document.getElementById(`comic${idx+1}`).classList.add("show");
}

/* DIAGRAM SCENE MAP */
// Update renderDiagramMap function
function renderDiagramMap(){
    const overlay = document.getElementById("diagram-map-overlay");
    overlay.style.display = "block";

    const container = document.getElementById("diagram-map-container");
    container.innerHTML = ""; // Clear previous nodes

    Object.keys(scenes).forEach(sceneKey=>{
        let node = document.createElement("div");
        node.style.display="inline-block";
        node.style.margin="8px";
        node.style.padding="10px 14px";
        node.style.background="#66c2ff";
        node.style.color="#000";
        node.style.borderRadius="6px";
        node.style.cursor="pointer";
        node.innerText = sceneKey;
        node.onclick = ()=>{
            overlay.style.display="none"; // close map
            show(sceneKey); // go to scene
        }
        container.appendChild(node);
    });
}

// Close button
document.getElementById("close-map-btn").onclick = ()=>{
    document.getElementById("diagram-map-overlay").style.display = "none";
};


/* SHOW SCENES */
function show(scene){
    let s = scenes[scene];
    if(!s) return;
    previousScene = scene;

    let dialog = document.getElementById("dialogue-box");
    dialog.classList.remove("visible");
    setTimeout(()=>{
        document.getElementById("name").innerText = s.name;
        document.getElementById("text").innerText = s.text;

        let choicesDiv = document.getElementById("choices");
        choicesDiv.innerHTML="";
        if(s.choices){
            s.choices.forEach(choice=>{
                let btn = document.createElement("div");
                btn.className="choice";
                btn.innerText = choice.text;
                btn.onclick = ()=>show(choice.next);
                choicesDiv.appendChild(btn);
            });
        }

        let extra = document.getElementById("extra-buttons");
        extra.innerHTML="";

        if(previousScene && previousScene!==scene){
            let backBtn = document.createElement("div");
            backBtn.className="extra-btn";
            backBtn.innerText="Back";
            backBtn.onclick = ()=>show(previousScene);
            extra.appendChild(backBtn);
        }

        let mapBtn = document.createElement("div");
        mapBtn.className="extra-btn";
        mapBtn.innerText="Diagram Map";
        mapBtn.onclick = renderDiagramMap;
        extra.appendChild(mapBtn);

        // Characters
        const container = document.getElementById("characters-container");
        container.innerHTML="";
        if(s.char){
            s.char.forEach((imgName, i) => {
    let img = document.createElement("img");
    img.src = imgName;
    img.className = "character-img show";
    img.style.height = "50%"; // smaller size
    img.style.bottom = "150px"; // above dialogue box
    img.style.left = `${i*120}px`;
    container.appendChild(img);
});

        }

        // Background
        document.getElementById("game-container").style.backgroundImage = `url(${s.bg})`;

        dialog.classList.add("visible");
    },100);
}
</script>

</body>
</html>
